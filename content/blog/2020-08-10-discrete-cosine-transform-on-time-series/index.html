---
title: Discrete Cosine Transform and Time Series Dimensionality Reduction
author: Tim Mastny
date: '2020-08-10'
slug: discrete-cosine-transform-on-time-series
categories: []
tags: []
output:
  blogdown::html_page:
    toc: true
---

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>

<div id="TOC">
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#data-compression">Data compression</a></li>
<li><a href="#what-is-the-discrete-cosine-transform">What is the discrete cosine transform?</a>
<ul>
<li><a href="#time-series-as-wiggles">Time series as wiggles</a></li>
<li><a href="#define-wiggliness">Define wiggliness</a></li>
<li><a href="#wiggles-waver-between-time-series">Wiggles waver between time series</a></li>
</ul></li>
</ul>
</div>

<blockquote>
<p>Note: This is the beginning of a series of articles for my <a href="https://github.com/tmastny/tsrecipes">tsrecipes</a>
package. The package is under development and subject to change.</p>
</blockquote>
<hr />
<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>The discrete cosine transform (DCT) is a technique from data compression you can
use for time series dimensionality reduction.</p>
<p>I’ll share a time series with 1751 observations,
that can be reduced to 40 uncorrelated features. These features also
give much better results when doing time series classification and clustering.</p>
<p>My next post will cover what the discrete cosine transform actually is,
and how it provides such a high degree of dimensionality reduction.</p>
<p>I’ll share how to use the discrete cosine transform on time series for
dimensionality reduction,
to aid in time series classification and clustering.</p>
<p>Then I’ll explore how</p>
<p>I’ll talk about two concepts:</p>
<ul>
<li>time series smoothing to identify the
<a href="https://otexts.com/fpp3/tspatterns.html">time series trend</a></li>
<li>dimensionality reduction and feature engineering for time series
cluster and classification</li>
</ul>
<p>Both of these are possible because DCT is
<a href="https://en.wikipedia.org/wiki/Transform_coding#:~:text=Transform%20coding%20is%20a%20type,audio%20signals%20or%20photographic%20images.">perfectly reverible</a></p>
</div>
<div id="data-compression" class="section level2">
<h2>Data compression</h2>
<pre class="r"><code>library(tsrecipes)
library(tidyverse)</code></pre>
<p>The primary application of the discrete cosine transform is in data compression:</p>
<blockquote>
<p>data compression is the art or science of representing information in a
more compact form.
- <em>Sayood, K. Introduction to Data Compression</em></p>
</blockquote>
<p>There’s a natural connection here to machine learning:
we often way to represent high-dimensional features with fewer dimensions,
to save memory and computing and improve accuracy.</p>
<p>Statistical techniques like Principle Component Analysis (PCA) can even
be thought of as a <a href="http://www.statistics4u.info/fundstat_eng/cc_pca_compress.html">data compression</a>
algorithm.</p>
<p>In data compression, correlation implies redundant information.
Coding that removes or transforms these redundancies can also be beneficial
to machine learning, where highly correlated features, such values in a time
series, may harm accuracy.</p>
<p>Therefore, the discrete cosine transform offers</p>
<ul>
<li>time series smoothing</li>
<li>uncorrelated features</li>
<li>unsupervised dimensionality reduction</li>
</ul>
</div>
<div id="what-is-the-discrete-cosine-transform" class="section level2">
<h2>What is the discrete cosine transform?</h2>
<p>Sid Shanker provides an intuitive <a href="https://squidarth.com/rc/math/2018/06/24/fourier.html">introduction</a>
to the discrete cosine transform in the context of data compression.
In this article, I’ll demonstrate how we can apply the discrete cosine transform
to a single time series.</p>
<div id="time-series-as-wiggles" class="section level3">
<h3>Time series as wiggles</h3>
<p>Let’s think about the <em>wiggliness</em> of time series.</p>
<pre class="r"><code>ts &lt;- ethanol$ts[[1]]
ts_dct &lt;- tibble(
  ts = ts,
  dct = fdct(ts),
  n = 1:length(ts)
)</code></pre>
<pre class="r"><code>ts_recon &lt;- ts_dct %&gt;%
  mutate(
    dct_lf = ifelse(seq_along(dct) &lt;= 20, dct, 0),
    ts_lf = dtt::dct(dct_lf, inverted = TRUE),
    dct_hf = ifelse(between(seq_along(dct), 20, 40), dct, 0),
    ts_hf = dtt::dct(dct_hf, inverted = TRUE)
  )

ts_recon %&gt;%
  pivot_longer(c(ts, ts_hf, ts_lf)) %&gt;%
  ggplot() +
  geom_line(aes(n, value, color = name))</code></pre>
<p><img src="/blog/2020-08-10-discrete-cosine-transform-on-time-series/index_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>The original time series (in red) can be thought of as a combination of different
wiggles. The blue line represents the <em>low-frequency</em> wiggles: these are wiggles
that go up and down relatively slowly.</p>
<p>The red line represents <em>high-frequency</em> wiggles, the wiggles that change
quickly and sharply.</p>
<p>If we add those two together</p>
<pre class="r"><code>ts_recon = ts_hf + ts_lf</code></pre>
<p>we can reconstruct the general shape of the original time series.</p>
<pre class="r"><code>ts_recon %&gt;%
  mutate(ts_recon = ts_hf + ts_lf) %&gt;%
  pivot_longer(c(ts, ts_recon)) %&gt;%
  ggplot() +
  geom_line(aes(n, value, color = name))</code></pre>
<p><img src="/blog/2020-08-10-discrete-cosine-transform-on-time-series/index_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>Except there’s a major difference: I decreased the dimension of the time series
from 1751 to <strong>40</strong>. If I would have included all the dimensions, I would have
reproduced the time series exactly.</p>
<p>The dimensional reduction is the magic of the discrete cosine transform.
It allows us to remove dimensions that don’t contribute to the overall “shape”
of the time series.</p>
</div>
<div id="define-wiggliness" class="section level3">
<h3>Define wiggliness</h3>
<p>Thanks to trigonometry (SOH CAH TOA) and
<a href="https://en.wikipedia.org/wiki/Joseph_Fourier">Joseph Fourier</a>,
we can very precisely define what wiggliness means.</p>
<p>Imagine a sequence of cosine waves, with increasing wiggles. This sequence
needs to be the same length as the time series,
but I’ll only show a few to to demonstrate.</p>
<pre class="r"><code>cosine &lt;- function(i, j = 1:60) {
  cos(pi / length(j) * i * (j + 1/2))
}</code></pre>
<pre class="r"><code>fib &lt;- c(1, 2, 3, 5, 8, 13)

cosine1 &lt;- ts_recon %&gt;%
  rowwise() %&gt;%
  mutate(
    cosine = list(cosine(n, j = 1:1751)),
    cosine_scale = list(dct * cosine),
    i = list(1:1751)
  ) %&gt;%
  filter(n %in% fib) %&gt;%
  unnest(c(i, cosine, cosine_scale)) %&gt;%
  ggplot() +
  geom_line(aes(i, cosine)) +
  facet_wrap(~n) +
  labs(x = NULL, y = NULL)

cosine1</code></pre>
<p><img src="/blog/2020-08-10-discrete-cosine-transform-on-time-series/index_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>As we saw in the previous example, there are cases where we can add up wiggles
to get back the original time series. But these cosine waves won’t do,
because each only ranges from -1 to 1. Our time series ranged from -1 to 2.</p>
<p>The discrete cosine transforms provides the amplitudes for this cosine sequence,
for any time series.
We can multiple the waves by the amplitudes to see how much each wave
contributes to the reconstruction.</p>
<pre class="r"><code>cosine1_scaled &lt;- ts_recon %&gt;%
  rowwise() %&gt;%
  mutate(
    cosine = list(cosine(n, j = 1:1751)),
    cosine_scale = list(dct * cosine),
    i = list(1:1751)
  ) %&gt;%
  filter(n %in% fib) %&gt;%
  unnest(c(i, cosine, cosine_scale)) %&gt;%
  ggplot() +
  geom_line(aes(i, cosine_scale)) +
  facet_wrap(~n) +
  labs(x = NULL, y = NULL)

cosine1_scaled</code></pre>
<p><img src="/blog/2020-08-10-discrete-cosine-transform-on-time-series/index_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>The waves flip and grow based on the sign and size of the coefficients.
Some are very small, but some seem unrealistically large like #3,
ranging from -1000 to 1000. But rest assured, we can use these to reconstruct
the original time series.</p>
<p>Also, remember that this sequence of cosine waves get more wiggly as time goes
on. If we look at the amplitudes (discrete cosine transform coefficients)
of the time series, we see that it trends toward zero.</p>
<pre class="r"><code>ts_recon %&gt;%
  ggplot(aes(n, dct)) +
  geom_line() + 
  geom_smooth() +
  scale_y_log10(labels = scales::comma)</code></pre>
<p><img src="/blog/2020-08-10-discrete-cosine-transform-on-time-series/index_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>This means that the <em>really</em> wiggly cosine waves don’t contribute very much
to the time series, which is why we could reconstruct with only 50 features.</p>
<p>The high frequency features don’t contribute much, because the overall
shape of the time series is a big, low-frequency hump.</p>
</div>
<div id="wiggles-waver-between-time-series" class="section level3">
<h3>Wiggles waver between time series</h3>
<p>You can’t necessarily assume that high frequencies are irrelevant.
It depends on the characteristics of the time series. For example:</p>
<pre class="r"><code>ts &lt;- prices$ts[[1]]
ts_dct &lt;- tibble(
  ts = ts,
  dct = fdct(ts),
  n = 1:length(ts)
)</code></pre>
<pre class="r"><code>ts_recon &lt;- ts_dct %&gt;%
  mutate(
    dct_lf = ifelse(seq_along(dct) &lt;= 20, dct, 0),
    ts_lf = dtt::dct(dct_lf, inverted = TRUE),
    dct_hf = ifelse(between(seq_along(dct), 40, 60), dct, 0),
    ts_hf = dtt::dct(dct_hf, inverted = TRUE)
  )

ts_recon %&gt;%
  pivot_longer(c(ts, ts_hf, ts_lf)) %&gt;%
  ggplot() +
  geom_line(aes(n, value, color = name))</code></pre>
<p><img src="/blog/2020-08-10-discrete-cosine-transform-on-time-series/index_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>in this time series, it’s the high frequency green time series that’s better a
better reconstruction of the original.</p>
<p>Dimensionality reduction with discrete cosine transform depends on the
characteristics of the time series, so you either need to use your judgment
or tune the number of coefficients selected.</p>
</div>
</div>
